<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Reproducing Uber&#39;s Marketplace Optimization | Gabe&#39;s Gulch</title>
<meta name="keywords" content="">
<meta name="description" content="Uber allocates money across different regions and programs to incentivize riders and drivers to use Uber products. This incentive structure ultimately influences the market. This leads to the natural question of &ldquo;how much to allocate to each city and which program&rdquo; to maximize business objectives? Uber has a finite amount of money that must be allocated accordingly. Given a total budget of say, $1,000,000, how should it be divied up amongst the cities and programs?">
<meta name="author" content="Gabriel Stechschulte">
<link rel="canonical" href="http://localhost:1313/posts/2025-09-08-marketplace-optimization/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/2025-09-08-marketplace-optimization/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
    integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV"
    crossorigin="anonymous"
/>
<script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
    integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"
    crossorigin="anonymous"
></script>
<script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
    crossorigin="anonymous"
></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true },
            ],
            throwOnError: false,
        });
    });
</script>


</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Gabe&#39;s Gulch (Alt + H)">Gabe&#39;s Gulch</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives/" title="archives">
                    <span>archives</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="categories">
                    <span>categories</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Reproducing Uber&#39;s Marketplace Optimization
    </h1>
    <div class="post-meta"><span title='2025-09-15 00:00:00 +0000 UTC'>September 15, 2025</span>&nbsp;·&nbsp;12 min&nbsp;·&nbsp;Gabriel Stechschulte

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#data-simulation" aria-label="Data simulation">Data simulation</a></li>
                <li>
                    <a href="#implementation" aria-label="Implementation">Implementation</a><ul>
                        
                <li>
                    <a href="#user-causal-effect-estimator" aria-label="User Causal Effect Estimator">User Causal Effect Estimator</a></li>
                <li>
                    <a href="#smoothing-model" aria-label="Smoothing model">Smoothing model</a></li>
                <li>
                    <a href="#optimizer" aria-label="Optimizer">Optimizer</a></li></ul>
                </li>
                <li>
                    <a href="#results" aria-label="Results">Results</a></li>
                <li>
                    <a href="#conclusion" aria-label="Conclusion">Conclusion</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>Uber allocates money across different regions and programs to incentivize riders and drivers to use Uber products. This incentive structure ultimately influences the market. This leads to the natural question of &ldquo;how much to allocate to each city and which program&rdquo; to maximize business objectives? Uber has a finite amount of money that must be allocated accordingly. Given a total budget of say, $1,000,000, how should it be divied up amongst the cities and programs?</p>
<p>Uber has developed an automated system for answering such a question. In this post, I will be reproducing the paper <a href="https://arxiv.org/abs/2407.19078">Practical Marketplace Optimization at Uber Using Causally-Informed Machine Learning</a> in JAX on a simulated marketplace dataset. The main objective of this post is to: (1) develop a neural network that learns the association between budget allocations and marketplace outcomes, and (2) implement the Alternating Direction Method of Multipliers (ADMM) algorithm in the context of resource allocation problems using the neural network.</p>
<h2 id="data-simulation">Data simulation<a hidden class="anchor" aria-hidden="true" href="#data-simulation">#</a></h2>
<p>In order to better understand how the neural network is embedded into ADMM and how ADMM works, a simple marketplace dataset with three cities and one program for each city is simulated. To maintain some of the real-life characteristics of the data, non-linearity and interaction effects are introduced. This results in the following graphs</p>
<p><img loading="lazy" src="figures/marketplace_simulation.png" alt="marketplace-simulation"  />
</p>
<p>Depending on the total budget allocation constraint, a reasonable budget allocation should be approximately $$2500, $3500, and $5000 for city 0, 1, and 2, respectively.</p>
<h2 id="implementation">Implementation<a hidden class="anchor" aria-hidden="true" href="#implementation">#</a></h2>
<p>There are four main methodological components in Uber&rsquo;s automated budget allocation system</p>
<ol>
<li><strong>User Causal Effect Estimator</strong>. A deep learning (DL) model that uses historical data to predict marketplace outcomes such as gross bookings for each region.</li>
<li><strong>Smoothing Layer</strong>. Used to generate a differentiable low-dimensional response surface from the DL model outputs in order to more efficiently perform optimization.</li>
<li><strong>Optimizer</strong>. Computes the optimal budget allocation for each region and lever subject to the marketplace model dynamics and business operation constraints.</li>
<li><strong>Business Value Evaluation</strong>. An evaluation framework to measure the quality of the optimal budget allocations.</li>
</ol>
<p>In this post, we will discuss components 1-3 and implement the DL model and ADMM algorithm.</p>
<h3 id="user-causal-effect-estimator">User Causal Effect Estimator<a hidden class="anchor" aria-hidden="true" href="#user-causal-effect-estimator">#</a></h3>
<p>For the user causal effect estimator, I implement a simple neural network with an embedding layer for the &ldquo;sparse&rdquo; categorical features (cities) and a linear layer for the &ldquo;dense&rdquo; numerical features (budgets). The sparse and dense feature embeddings are then concatenated and fed through a series of ResNet blocks. However, for simplicity, I use MLPs.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MarketModel</span>(nnx<span style="color:#f92672">.</span>Module):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(
</span></span><span style="display:flex;"><span>        self,
</span></span><span style="display:flex;"><span>        num_cities: int,
</span></span><span style="display:flex;"><span>        city_embedding_dim: int,
</span></span><span style="display:flex;"><span>        budget_embedding_dim: int,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">*</span>,
</span></span><span style="display:flex;"><span>        rngs: nnx<span style="color:#f92672">.</span>Rngs,
</span></span><span style="display:flex;"><span>    ):
</span></span><span style="display:flex;"><span>        input_dim <span style="color:#f92672">=</span> city_embedding_dim <span style="color:#f92672">+</span> budget_embedding_dim
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Sparse embedding layer (for categorical features)</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>city_embedding <span style="color:#f92672">=</span> nnx<span style="color:#f92672">.</span>Embed(
</span></span><span style="display:flex;"><span>            num_embeddings<span style="color:#f92672">=</span>num_cities, features<span style="color:#f92672">=</span>city_embedding_dim, rngs<span style="color:#f92672">=</span>rngs
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Dense feature extractor (for numerical features)</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>budget_embedding <span style="color:#f92672">=</span> nnx<span style="color:#f92672">.</span>Linear(<span style="color:#ae81ff">1</span>, budget_embedding_dim, rngs<span style="color:#f92672">=</span>rngs)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>linear1 <span style="color:#f92672">=</span> nnx<span style="color:#f92672">.</span>Linear(input_dim, <span style="color:#ae81ff">128</span>, rngs<span style="color:#f92672">=</span>rngs)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>linear2 <span style="color:#f92672">=</span> nnx<span style="color:#f92672">.</span>Linear(<span style="color:#ae81ff">128</span>, <span style="color:#ae81ff">256</span>, rngs<span style="color:#f92672">=</span>rngs)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>linear3 <span style="color:#f92672">=</span> nnx<span style="color:#f92672">.</span>Linear(<span style="color:#ae81ff">256</span>, <span style="color:#ae81ff">128</span>, rngs<span style="color:#f92672">=</span>rngs)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>linear4 <span style="color:#f92672">=</span> nnx<span style="color:#f92672">.</span>Linear(<span style="color:#ae81ff">128</span>, <span style="color:#ae81ff">16</span>, rngs<span style="color:#f92672">=</span>rngs)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>out <span style="color:#f92672">=</span> nnx<span style="color:#f92672">.</span>Linear(<span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">1</span>, rngs<span style="color:#f92672">=</span>rngs)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__call__</span>(self, city_idx: Array, budget: Array) <span style="color:#f92672">-&gt;</span> Array:
</span></span><span style="display:flex;"><span>        budget_embedding <span style="color:#f92672">=</span> nnx<span style="color:#f92672">.</span>relu(self<span style="color:#f92672">.</span>budget_embedding(budget))
</span></span><span style="display:flex;"><span>        city_embedding <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>city_embedding(city_idx)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Sparse and dense feature embeddings are concatenated</span>
</span></span><span style="display:flex;"><span>        combined_input <span style="color:#f92672">=</span> jnp<span style="color:#f92672">.</span>concatenate([city_embedding, budget_embedding], axis<span style="color:#f92672">=-</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> nnx<span style="color:#f92672">.</span>relu(self<span style="color:#f92672">.</span>linear1(combined_input))
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> nnx<span style="color:#f92672">.</span>relu(self<span style="color:#f92672">.</span>linear2(x))
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> nnx<span style="color:#f92672">.</span>relu(self<span style="color:#f92672">.</span>linear3(x))
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> nnx<span style="color:#f92672">.</span>relu(self<span style="color:#f92672">.</span>linear4(x))
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>out(x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> x
</span></span></code></pre></div><p>The input to the <code>MarketModel</code> is an array of city indices and budgets. Training the model and plotting the model&rsquo;s predictions results in the following graph below. This simple neural network architecture is able to learn the association between per-city budget allocations and business outcomes (gross bookings) reasonably well.</p>
<p><img loading="lazy" src="figures/marketplace_predictions.png" alt="marketplace-predictions"  />
</p>
<p>This model will then be embedded into the optimizer where we will differentiate and evaluate the response surface of the model. Repeatedly evaluating the response surface is like asking &ldquo;what happens if we increase driver incentives by 100 dollars in Chicago while decreasing rider promotions by 50 dollars in Detriot&rdquo;? Then, when we taken the gradient of the outcome (bookings) with respect to the input (budgets), we get a sense of which direction maximizes our objective.</p>
<h3 id="smoothing-model">Smoothing model<a hidden class="anchor" aria-hidden="true" href="#smoothing-model">#</a></h3>
<p>The deep learning (DL) model produces a mapping from budgets to marketplace outcomes (supply, demand, gross bookings, etc.), which can be fed into an optimizer. However, the optimization routine require numerous passes over the response surface, necessitating many evaluations of the DL model, which is computationally costly. The response surface can be thought of a non-convex landscape where each point represents a different combination of budget amounts across various levers and cities where the height at each point shows the predicted business outcome.</p>
<p>The goal with the smoothing model is to generate a low-dimensional &ldquo;smooth&rdquo; differential surface for derivative-based optimization algorithms. Uber achieves this using Adaptive Sparse Grids (ASG) to strategically sample a grid-based representation of the DL surface. B-spline functions are then used as a smoothing model to approximate the response surface. B-splines are choosen because of their flexibility and analytical derivative forms. This B-spline model is then embeded into the ADMM algorithm to provide low-cost evaluations of the response surface.</p>
<p>As I simulate a dataset where I can visually see the optimal budget allocations for each city, I will not implement the smoothing model in this post. Instead, I will embed the DL model directly into the ADMM algorithm. Although, once more levers are added to each city or more features are added to the DL model, it would be interesting to analyze the impacts the smoothing model has on the ADMM results.</p>
<h3 id="optimizer">Optimizer<a hidden class="anchor" aria-hidden="true" href="#optimizer">#</a></h3>
<p>ADMM is used to solve the non-linear, non-convex resource allocation problem. The objective is to break up a total budget into smaller budgets for each city and program. This allows us to separate the single-city cross-lever problem and the cross-city problem and solve both problems iteratively. The objective function to solve is</p>
<p>$$
\begin{aligned}
\min_{\mathbf{b}, \mathbf{z}} \quad &amp; \sum_{c \in \text{cities}} f_c(\mathbf{b}_c) + g(\mathbf{z}) \\
\text{s.t.} \quad &amp; \mathbf{b}_c - \mathbf{z}_c = \mathbf{0}, \quad \forall c \in \text{cities}
\end{aligned}
$$</p>
<p>and the ADMM algorithm consists of three steps:</p>
<ul>
<li>$\mathbf{b}$ <strong>update</strong>. This step optimizes each city independently given the current consensus $\mathbf{z}$ and duals $\mathbf{y}$ effectively balancing the primary objective (maximize the outcome for <em>this</em> city), consensus penalty (stay close to the consensus target allocation), and the business penalty (don&rsquo;t stray too far from the reference budget allocation).</li>
</ul>
<p>$$
\begin{aligned}
\mathbf{b}_c^{k+1} := \underset{\mathbf{b}_c}{\operatorname{argmin}} \left( f_c(\mathbf{b}_c) + \frac{\rho}{2} \left\lVert \mathbf{b}_c - \mathbf{z}^k + \mathbf{y}_c^k \right\rVert_2^2 \right) \\
\end{aligned}
$$</p>
<ul>
<li>$\mathbf{z}$ <strong>update</strong>. Coordinates across all cities to satisfy the global (total) budget constraint and computes the consensus allocation closest to the city preferences $\mathbf{b}_c^{k+1} + \mathbf{y}_c^k$. (<em>Note</em>: The summation term sums over all cities. Hugo is being a pain and won&rsquo;t compile a summation with multiple subscripts)</li>
</ul>
<p>$$
\begin{aligned}
\mathbf{z}_c^{k+1} := \underset{\mathbf{z}}{\operatorname{argmin}} \left( g(\mathbf{z}) + \frac{\rho}{2} \sum_c \left\lVert \mathbf{b}_c^{k+1} - \mathbf{z}_c + \mathbf{y}_c^k \right\rVert_2^2 \right)  \\
\end{aligned}
$$</p>
<ul>
<li>$\mathbf{y}$ <strong>update</strong>. Accumulates constraint violations between city budget and the consensus allocation.</li>
</ul>
<p>$$
\begin{aligned}
\mathbf{y}_c^{k+1} := \mathbf{y}_c^{k} + \mathbf{b}_c^{k+1} - \mathbf{z}_c^{k+1}
\end{aligned}
$$</p>
<p>where $\rho$ is a penalty for total budget constraint violations. This parameter controls the tradeoff between how many gross bookings we are willing to sacrifice to reduce the total budget constraint violation. Small $\rho$ typically results in loose constraints and takes the ADMM algorithm longer to converge, and vice-versa. Uber also introduces another penalty term in the form of Hellinger distance that forces the algorithm to prefer allocations similar to a reference budget allocation. Instead of the Hellinger distance, I implement a simple quadratic penalty term scaled by $\phi$.</p>
<p>In primal-dual optimization methods, the dual variables, also known as Lagrange multipliers, provide valuable insights into the marginal effect of constraints on the objective function. These variables represent the shadow price of a given constraint, such as a city&rsquo;s budget, quantifying how much the total objective would improve if that budget were increased by one unit.</p>
<p>One of the reasons for the popularity of ADMM is that the $\mathbf{b}$ update step can be implemented in parallel. Although this step uses variables from the previous iteration, within this step, all the per-city problems can be optimized in parallel. JAX primitives lends itself well to a high-performance implementation of ADMM. We can easily perform the per-city update in parallel with <code>vmap</code>, use <code>lax.scan</code> for loops with state, and <code>jit</code> for computation heavy functions.</p>
<p>With that being said, the implementation is fairly straightforward. The ADMM algorithm is implemented via <code>ADMMAlgorithm</code> and is stateless. It takes <code>state</code> and a <code>step</code> function and then operates on this <code>state</code>. For each <code>step</code>, the algorithm outputs a new <code>state</code>. We can then run the algorithm for $n$ steps and accumulate the results. Moreover, the <code>step</code> function is JIT compiled so the XLA compiler traces and optimizes all the function therein.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">z_update</span>(budgets: Array, duals: Array, total_budget: float) <span style="color:#f92672">-&gt;</span> Array:
</span></span><span style="display:flex;"><span>    n_cities <span style="color:#f92672">=</span> len(budgets)
</span></span><span style="display:flex;"><span>    u_k <span style="color:#f92672">=</span> budgets <span style="color:#f92672">+</span> duals
</span></span><span style="display:flex;"><span>    adjustment <span style="color:#f92672">=</span> (total_budget <span style="color:#f92672">-</span> jnp<span style="color:#f92672">.</span>sum(u_k)) <span style="color:#f92672">/</span> n_cities
</span></span><span style="display:flex;"><span>    consensus <span style="color:#f92672">=</span> adjustment <span style="color:#f92672">+</span> u_k
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> consensus
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">y_update</span>(budgets: Array, consensus: Array, duals: Array) <span style="color:#f92672">-&gt;</span> Array:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> duals <span style="color:#f92672">+</span> budgets <span style="color:#f92672">-</span> consensus
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">city_objective</span>(model_fn: Callable) <span style="color:#f92672">-&gt;</span> Callable:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">objective</span>(
</span></span><span style="display:flex;"><span>        budget: float,
</span></span><span style="display:flex;"><span>        city: int,
</span></span><span style="display:flex;"><span>        consensus: float,
</span></span><span style="display:flex;"><span>        dual: float,
</span></span><span style="display:flex;"><span>        reference: float,
</span></span><span style="display:flex;"><span>        rho: float,
</span></span><span style="display:flex;"><span>        phi: float,
</span></span><span style="display:flex;"><span>    ):
</span></span><span style="display:flex;"><span>        outcome <span style="color:#f92672">=</span> model_fn(jnp<span style="color:#f92672">.</span>array([city]), jnp<span style="color:#f92672">.</span>array([[budget]]))<span style="color:#f92672">.</span>squeeze()
</span></span><span style="display:flex;"><span>        admm_penalty <span style="color:#f92672">=</span> rho <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> (budget <span style="color:#f92672">-</span> consensus <span style="color:#f92672">+</span> dual) <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        business_penalty <span style="color:#f92672">=</span> phi <span style="color:#f92672">*</span> (budget <span style="color:#f92672">-</span> reference) <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span>outcome <span style="color:#f92672">+</span> admm_penalty <span style="color:#f92672">+</span> business_penalty
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> objective
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">b_update</span>(
</span></span><span style="display:flex;"><span>    objective_fn: Callable,
</span></span><span style="display:flex;"><span>    min_budget: float,
</span></span><span style="display:flex;"><span>    max_budget: float,
</span></span><span style="display:flex;"><span>    lr: float,
</span></span><span style="display:flex;"><span>    n_steps: int,
</span></span><span style="display:flex;"><span>) <span style="color:#f92672">-&gt;</span> Callable:
</span></span><span style="display:flex;"><span>    optimizer <span style="color:#f92672">=</span> optax<span style="color:#f92672">.</span>adam(learning_rate<span style="color:#f92672">=</span>lr)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">update</span>(
</span></span><span style="display:flex;"><span>        city: int,
</span></span><span style="display:flex;"><span>        budget: float,
</span></span><span style="display:flex;"><span>        consensus: float,
</span></span><span style="display:flex;"><span>        dual: float,
</span></span><span style="display:flex;"><span>        reference: float,
</span></span><span style="display:flex;"><span>        rho: float,
</span></span><span style="display:flex;"><span>        phi: float,
</span></span><span style="display:flex;"><span>    ):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">obj_fn</span>(x):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> objective_fn(x, city, consensus, dual, reference, rho, phi)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">scan_fn</span>(carry, _):
</span></span><span style="display:flex;"><span>            budget_val, opt_state_val <span style="color:#f92672">=</span> carry
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Compute gradient w.r.t this budget</span>
</span></span><span style="display:flex;"><span>            loss_val, grad_val <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>value_and_grad(obj_fn)(budget_val)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Update and apply</span>
</span></span><span style="display:flex;"><span>            updates, new_opt_state <span style="color:#f92672">=</span> optimizer<span style="color:#f92672">.</span>update(
</span></span><span style="display:flex;"><span>                grad_val, opt_state_val, budget_val
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>            new_budget_unconstrained <span style="color:#f92672">=</span> optax<span style="color:#f92672">.</span>apply_updates(budget_val, updates)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Projection</span>
</span></span><span style="display:flex;"><span>            projected_budget <span style="color:#f92672">=</span> optax<span style="color:#f92672">.</span>projections<span style="color:#f92672">.</span>projection_box(
</span></span><span style="display:flex;"><span>                new_budget_unconstrained, min_budget, max_budget
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> (projected_budget, new_opt_state), loss_val
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        current_budget <span style="color:#f92672">=</span> budget
</span></span><span style="display:flex;"><span>        opt_state <span style="color:#f92672">=</span> optimizer<span style="color:#f92672">.</span>init(budget)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        (final_budget, _), losses <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>lax<span style="color:#f92672">.</span>scan(
</span></span><span style="display:flex;"><span>            scan_fn, (current_budget, opt_state), <span style="color:#66d9ef">None</span>, length<span style="color:#f92672">=</span>n_steps
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> final_budget
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> update
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">build_admm</span>(model_fn: Callable, config: ADMMConfig) <span style="color:#f92672">-&gt;</span> ADMMAlgorithm:
</span></span><span style="display:flex;"><span>    city_obj <span style="color:#f92672">=</span> city_objective(model_fn)
</span></span><span style="display:flex;"><span>    b_update_ <span style="color:#f92672">=</span> b_update(
</span></span><span style="display:flex;"><span>        city_obj, config<span style="color:#f92672">.</span>min_budget, config<span style="color:#f92672">.</span>max_budget, config<span style="color:#f92672">.</span>lr, config<span style="color:#f92672">.</span>n_optim_steps
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    b_update_vmap <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>vmap(
</span></span><span style="display:flex;"><span>        b_update_,
</span></span><span style="display:flex;"><span>        in_axes<span style="color:#f92672">=</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">None</span>, <span style="color:#66d9ef">None</span>),  <span style="color:#75715e"># Vectorize over cities</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">init_fn</span>(initial_budgets: Array) <span style="color:#f92672">-&gt;</span> ADMMState:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ADMMState(
</span></span><span style="display:flex;"><span>            budgets<span style="color:#f92672">=</span>initial_budgets,
</span></span><span style="display:flex;"><span>            consensus<span style="color:#f92672">=</span>initial_budgets,
</span></span><span style="display:flex;"><span>            duals<span style="color:#f92672">=</span>jnp<span style="color:#f92672">.</span>zeros(config<span style="color:#f92672">.</span>n_cities),
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">step_fn</span>(state: ADMMState) <span style="color:#f92672">-&gt;</span> Tuple[ADMMState, ADMMInfo]:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Vectorized per-city budget updates</span>
</span></span><span style="display:flex;"><span>        city_indices <span style="color:#f92672">=</span> jnp<span style="color:#f92672">.</span>arange(config<span style="color:#f92672">.</span>n_cities)
</span></span><span style="display:flex;"><span>        new_budgets <span style="color:#f92672">=</span> b_update_vmap(
</span></span><span style="display:flex;"><span>            city_indices,
</span></span><span style="display:flex;"><span>            state<span style="color:#f92672">.</span>budgets,
</span></span><span style="display:flex;"><span>            state<span style="color:#f92672">.</span>consensus,
</span></span><span style="display:flex;"><span>            state<span style="color:#f92672">.</span>duals,
</span></span><span style="display:flex;"><span>            config<span style="color:#f92672">.</span>reference_budget,
</span></span><span style="display:flex;"><span>            config<span style="color:#f92672">.</span>rho,
</span></span><span style="display:flex;"><span>            config<span style="color:#f92672">.</span>phi,
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        new_consensus <span style="color:#f92672">=</span> z_update(new_budgets, state<span style="color:#f92672">.</span>duals, config<span style="color:#f92672">.</span>total_budget)
</span></span><span style="display:flex;"><span>        new_duals <span style="color:#f92672">=</span> y_update(new_budgets, new_consensus, state<span style="color:#f92672">.</span>duals)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Updated state</span>
</span></span><span style="display:flex;"><span>        new_state <span style="color:#f92672">=</span> ADMMState(
</span></span><span style="display:flex;"><span>            budgets<span style="color:#f92672">=</span>new_budgets, consensus<span style="color:#f92672">=</span>new_consensus, duals<span style="color:#f92672">=</span>new_duals
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        new_objective <span style="color:#f92672">=</span> jnp<span style="color:#f92672">.</span>sum(jax<span style="color:#f92672">.</span>vmap(model_fn)(city_indices, new_budgets[:, <span style="color:#66d9ef">None</span>]))
</span></span><span style="display:flex;"><span>        primal_residual <span style="color:#f92672">=</span> jnp<span style="color:#f92672">.</span>linalg<span style="color:#f92672">.</span>norm(new_budgets <span style="color:#f92672">-</span> new_consensus)
</span></span><span style="display:flex;"><span>        dual_residual <span style="color:#f92672">=</span> jnp<span style="color:#f92672">.</span>abs(jnp<span style="color:#f92672">.</span>sum(new_budgets) <span style="color:#f92672">-</span> config<span style="color:#f92672">.</span>total_budget)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Updated info</span>
</span></span><span style="display:flex;"><span>        new_info <span style="color:#f92672">=</span> ADMMInfo(
</span></span><span style="display:flex;"><span>            objective<span style="color:#f92672">=</span>new_objective,
</span></span><span style="display:flex;"><span>            primal_residual<span style="color:#f92672">=</span>primal_residual,
</span></span><span style="display:flex;"><span>            dual_residual<span style="color:#f92672">=</span>dual_residual,
</span></span><span style="display:flex;"><span>            converged<span style="color:#f92672">=</span>primal_residual <span style="color:#f92672">&lt;</span> config<span style="color:#f92672">.</span>tol,
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> new_state, new_info
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> ADMMAlgorithm(init_fn, step_fn)
</span></span></code></pre></div><h2 id="results">Results<a hidden class="anchor" aria-hidden="true" href="#results">#</a></h2>
<p>The ADMM algorithm is initialized as follows</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Budget constraints scaled by the maximum allowed budget</span>
</span></span><span style="display:flex;"><span>total_budget <span style="color:#f92672">=</span> <span style="color:#ae81ff">15000.0</span> <span style="color:#f92672">/</span> max_budget
</span></span><span style="display:flex;"><span>min_budget_per_city <span style="color:#f92672">=</span> <span style="color:#ae81ff">3000.0</span> <span style="color:#f92672">/</span> max_budget
</span></span><span style="display:flex;"><span>max_budget_per_city <span style="color:#f92672">=</span> <span style="color:#ae81ff">8000.0</span> <span style="color:#f92672">/</span> max_budget
</span></span><span style="display:flex;"><span>tolerance <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span> <span style="color:#f92672">/</span> max_budget
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Initial and reference budgets scaled by the maximum allowed budget</span>
</span></span><span style="display:flex;"><span>init_budgets <span style="color:#f92672">=</span> jnp<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">1000.0</span>, <span style="color:#ae81ff">1000.0</span>, <span style="color:#ae81ff">1000.0</span>]) <span style="color:#f92672">/</span> max_budget
</span></span><span style="display:flex;"><span>ref_budgets <span style="color:#f92672">=</span> jnp<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">5000.0</span>, <span style="color:#ae81ff">5000.0</span>, <span style="color:#ae81ff">5000.0</span>]) <span style="color:#f92672">/</span> max_budget
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>config <span style="color:#f92672">=</span> ADMMConfig(
</span></span><span style="display:flex;"><span>    n_cities<span style="color:#f92672">=</span>n_cities,
</span></span><span style="display:flex;"><span>    total_budget<span style="color:#f92672">=</span>total_budget,
</span></span><span style="display:flex;"><span>    reference_budget<span style="color:#f92672">=</span>ref_budgets,
</span></span><span style="display:flex;"><span>    rho<span style="color:#f92672">=</span><span style="color:#ae81ff">0.25</span>,
</span></span><span style="display:flex;"><span>    phi<span style="color:#f92672">=</span><span style="color:#ae81ff">0.001</span>,
</span></span><span style="display:flex;"><span>    lr<span style="color:#f92672">=</span><span style="color:#ae81ff">0.01</span>,
</span></span><span style="display:flex;"><span>    tol<span style="color:#f92672">=</span>tolerance,
</span></span><span style="display:flex;"><span>    min_budget<span style="color:#f92672">=</span>min_budget_per_city,
</span></span><span style="display:flex;"><span>    max_budget<span style="color:#f92672">=</span>max_budget_per_city,
</span></span><span style="display:flex;"><span>    n_optim_steps<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>admm <span style="color:#f92672">=</span> build_admm(model, config)
</span></span></code></pre></div><p>and the algorithm is ran for $n$ steps (or until convergence).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@partial</span>(jax<span style="color:#f92672">.</span>jit, static_argnames<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;algorithm&#34;</span>, <span style="color:#e6db74">&#34;n_steps&#34;</span>])
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run</span>(algorithm, initial_state, n_steps):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">scan_fn</span>(state, _):
</span></span><span style="display:flex;"><span>        new_state, info <span style="color:#f92672">=</span> algorithm<span style="color:#f92672">.</span>step(state)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> new_state, (info, new_state<span style="color:#f92672">.</span>budgets)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    final_state, (trace, budget_trace) <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>lax<span style="color:#f92672">.</span>scan(
</span></span><span style="display:flex;"><span>        scan_fn, initial_state, <span style="color:#66d9ef">None</span>, length<span style="color:#f92672">=</span>n_steps
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> final_state, trace, budget_trace
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>state <span style="color:#f92672">=</span> admm<span style="color:#f92672">.</span>init(init_budgets)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Warmup JIT compilation</span>
</span></span><span style="display:flex;"><span>_ <span style="color:#f92672">=</span> run(admm, state, <span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>jax<span style="color:#f92672">.</span>block_until_ready(_)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>start <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>final_state, trace, budget_trace <span style="color:#f92672">=</span> run(admm, state, <span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>jax<span style="color:#f92672">.</span>block_until_ready((final_state, trace, budget_trace))
</span></span><span style="display:flex;"><span>duration <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> start
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Running ADMM optimization
</span></span><span style="display:flex;"><span><span style="color:#f92672">==============================</span>
</span></span><span style="display:flex;"><span>Completed in            : 0.0248 sec.
</span></span><span style="display:flex;"><span>Final budgets           : <span style="color:#f92672">[</span>3964.27   4028.075  8000.0005<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Final objective         : 186.1875
</span></span><span style="display:flex;"><span>Final primal residual   : 0.038195
</span></span><span style="display:flex;"><span>Final dual residual     : 0.066156
</span></span><span style="display:flex;"><span>Budget sum              : 15992.35 <span style="color:#f92672">(</span>target: 15000.0<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>Running the algorithm for 10 iterations results in 186 gross bookings with allocations of <code>[3964, 4028, 8000]</code> for city 0, 1 and 2, and go over budget by almost $1,000. Visualizing the budget allocations over the ADMM iterations shows that the algorithm initially (iterations 1-3) explores different regions of the response surface for each city and then quickly identifies a near-optimal budget allocation for each city that maximizes the total gross bookings.</p>
<p><img loading="lazy" src="figures/admm_optimization.gif" alt="admm-animation"  />
</p>
<p>When performing non-convex optimization with methods such as ADMM, we do not have theoretical guarantees that the optimization algorithm has converged to an optimal solution. However, we can analyze various variables and or metrics to assess convergence and the quality of the solution. For ADMM, we will analyze the dual and primal residuals as well as the objective function (gross bookings) over the ADMM iterations.</p>
<p>At a high-level, the dual residual measures the consensus allocation stability, i.e., &ldquo;is the algorithm converging on a consensus allocation?&rdquo;, whereas the primal residual measures the original constraint violation, i.e., &ldquo;how much are we violating the total budget constraint?&rdquo;. The calculation for the primal and dual residuals are computed as follows</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Magnitude of consensus constraint violation</span>
</span></span><span style="display:flex;"><span>primal_residual <span style="color:#f92672">=</span> jnp<span style="color:#f92672">.</span>abs(jnp<span style="color:#f92672">.</span>sum(new_budgets) <span style="color:#f92672">-</span> config<span style="color:#f92672">.</span>total_budget)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Magnitude of consensus variable variation</span>
</span></span><span style="display:flex;"><span>dual_residual <span style="color:#f92672">=</span> config<span style="color:#f92672">.</span>rho <span style="color:#f92672">*</span> jnp<span style="color:#f92672">.</span>linalg<span style="color:#f92672">.</span>norm(new_consensus <span style="color:#f92672">-</span> state<span style="color:#f92672">.</span>consensus)
</span></span></code></pre></div><p>and plot the results</p>
<p><img loading="lazy" src="figures/admm_diagnostics.png" alt="admm-diagnostics"  />
</p>
<p>The amount of gross bookings is expected to increase and then flat line. In the paper, the authors state that they look for &ldquo;small&rdquo; changes in the objective value from the previous ADMM iteration.</p>
<p>The dual variables for each city&rsquo;s budget are expected to converge to a single common value. This convergence signifies an optimal allocation where the marginal return per dollar is equalized across all cities. For instance, if one city&rsquo;s dual variable were higher than another&rsquo;s it would indicate a higher marginal return for one city over another signaling that more budget should be allocated there.</p>
<p>The primal residuals, measuring how much we are violating the total budget constraint, should be &ldquo;small&rdquo; and exhibit stability over the ADMM iterations.</p>
<h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>With the simplified dataset and neural network, it appears that the ADMM implementation is computing the optimal budget allocations per-city. The implementation herein is vastly simplified compared to the system outlined by the authors. It would be interesting to add another lever dimension to each city to see the results from the ADMM algorithm.</p>
<p>Moreover, Uber uses Adaptive Sparse Grids (ASG) to learn a low-dimensional representation of the response surface generated by the DL model. A B-spline model is then used to generate a differentiable &ldquo;smooth&rdquo; response surface which is then embedded into the ADMM routine instead of the neural network directly. As more dimensions are added, it would also be interesting to analyze the impact of such methods on the optimization result.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Gabe&#39;s Gulch</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
