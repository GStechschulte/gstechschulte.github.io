<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.306">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gabriel Stechschulte">
<meta name="dcterms.date" content="2023-08-01">

<title>Cached - Google Summer of Code - Average Predictive Slopes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Cached</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Google Summer of Code - Average Predictive Slopes</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">open-source</div>
                <div class="quarto-category">python</div>
                <div class="quarto-category">bayesian-statistics</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Gabriel Stechschulte </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 1, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>It is currently the beginning of week ten of Google Summer of Code 2023. According to the original deliverables table outlined in my proposal, the goal was to have opened a draft PR for the basic functionality of the <code>plot_slopes</code>. Subsequently, week 11 was reserved to further develop the <code>plot_slopes</code> function, and to write tests and a notebook for the documentation, respectively.</p>
<p>However, at the beginning of week ten, I have a <a href="https://github.com/bambinos/bambi/pull/699">PR</a> open with the majority of the functionality that <a href="https://vincentarelbundock.github.io/marginaleffects/">marginaleffects</a> has for <code>slopes</code>. In addition, I also exposed the <code>slopes</code> function, added tests, and have a <a href="https://github.com/bambinos/bambi/pull/701">PR</a> open for the documentation.</p>
<p>Below is the documentation for <code>slopes</code> and <code>plot_slopes</code> in Bambi, and is a culmination of the work completed in weeks five through nine.</p>
<section id="plot-slopes" class="level1">
<h1>Plot Slopes</h1>
<p>Bambi’s sub-package <code>interpret</code> features a set of functions to help interpret complex regression models. The sub-package is inspired by the R package <a href="https://vincentarelbundock.github.io/marginaleffects/articles/predictions.html#conditional-adjusted-predictions-plot">marginaleffects</a>. In this notebook we will discuss two functions <code>slopes</code> and <code>plot_slopes</code>. These two functions allow the modeler to easier interpret slopes, either by a inspecting a summary output or plotting them.</p>
<p>Below, it is described why estimating the slope of the prediction function is useful in interpreting generalized linear models (GLMs), how this methodology is implemented in Bambi, and how to use <code>slopes</code> and <code>plot_slopes</code>. It is assumed that the reader is familiar with the basics of GLMs. If not, refer to the Bambi <a href="https://bambinos.github.io/bambi/notebooks/how_bambi_works.html#Link-functions">Basic Building Blocks</a> example.</p>
<section id="interpretation-of-regression-coefficients" class="level2">
<h2 class="anchored" data-anchor-id="interpretation-of-regression-coefficients">Interpretation of Regression Coefficients</h2>
<p>Assuming we have fit a linear regression model of the form</p>
<p><span class="math display">\[y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \dots + \beta_k x_k + \epsilon\]</span></p>
<p>the “safest” interpretation of the regression coefficients <span class="math inline">\(\beta\)</span> is as a comparison between two groups of items that differ by <span class="math inline">\(1\)</span> in the relevant predictor variable <span class="math inline">\(x_i\)</span> while being identical in all the other predictors. Formally, the predicted difference between two items <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> that differ by an amount <span class="math inline">\(n\)</span> on predictor <span class="math inline">\(k\)</span>, but are identical on all other predictors, the predicted difference is <span class="math inline">\(y_i - y_j\)</span> is <span class="math inline">\(\beta_kx\)</span>, on average.</p>
<p>However, once we move away from a regression model with a Gaussian response, the identity function, and no interaction terms, the interpretation of the coefficients are not as straightforward. For example, in a logistic regression model, the coefficients are on a different scale and are measured in logits (log odds), not probabilities or percentage points. Thus, you cannot interpret the coefficents as a “one unit increase in <span class="math inline">\(x_k\)</span> is associated with an <span class="math inline">\(n\)</span> percentage point decrease in <span class="math inline">\(y\)</span>”. First, the logits must be converted to the probability scale. Secondly, a one unit change in <span class="math inline">\(x_k\)</span> may produce a larger or smaller change in the outcome, depending upon how far away from zero the logits are.</p>
<p><code>slopes</code> and <code>plot_slopes</code>, by default, computes quantities of interest on the response scale for GLMs. For example, for a logistic regression model, this is the probability scale, and for a Poisson regression model, this is the count scale.</p>
<section id="interpreting-interaction-effects" class="level3">
<h3 class="anchored" data-anchor-id="interpreting-interaction-effects">Interpreting interaction effects</h3>
<p>Specifying interactions in a regression model is a way of allowing parameters to be conditional on certain aspects of the data. By contrast, for a model with no interactions, the parameters are <strong>not</strong> conditional and thus, the value of one parameter is not dependent on the value of another covariate. However, once interactions exist, multiple parameters are always in play at the same time. Additionally, interactions can be specified for either categorical, continuous, or both types of covariates. Thus, making the interpretation of the parameters more difficult.</p>
<p>With GLMs, every covariate essentially interacts with itself because of the link function. To demonstrate parameters interacting with themselves, consider the mean of a Gaussian linear model with an identity link function</p>
<p><span class="math display">\[\mu = \alpha + \beta x\]</span></p>
<p>where the rate of change in <span class="math inline">\(\mu\)</span> with respect to <span class="math inline">\(x\)</span> is just <span class="math inline">\(\beta\)</span>, i.e., the rate of change is constant no matter what the value of <span class="math inline">\(x\)</span> is. But when we consider GLMs with link functions used to map outputs to exponential family distribution parameters, calculating the derivative of the mean output <span class="math inline">\(\mu\)</span> with respect to the predictor is not as straightforward as in the Gaussian linear model. For example, computing the rate of change in a binomial probability <span class="math inline">\(p\)</span> with respect to <span class="math inline">\(x\)</span></p>
<p><span class="math display">\[p = \frac{exp(\alpha + \beta x)}{1 + exp(\alpha + \beta x)}\]</span></p>
<p>And taking the derivative of <span class="math inline">\(p\)</span> with respect to <span class="math inline">\(x\)</span> yields</p>
<p><span class="math display">\[\frac{\partial p}{\partial x} = \frac{\beta}{2(1 + cosh(\alpha + \beta x))}\]</span></p>
<p>Since <span class="math inline">\(x\)</span> appears in the derivative, the impact of a change in <span class="math inline">\(x\)</span> depends upon <span class="math inline">\(x\)</span>, i.e., an interaction with itself even though no interaction term was specified in the model.Thus, visualizing the rate of change in the mean response with respect to a covariate <span class="math inline">\(x\)</span> becomes a useful tool in interpreting GLMs.</p>
</section>
</section>
<section id="average-predictive-slopes" class="level2">
<h2 class="anchored" data-anchor-id="average-predictive-slopes">Average Predictive Slopes</h2>
<p>Here, we adopt the notation from Chapter 14.4 of <a href="https://avehtari.github.io/ROS-Examples/">Regression and Other Stories</a> to first describe average predictive differences which is essential to computing <code>slopes</code>, and then secondly, average predictive slopes. Assume we have fit a Bambi model predicting an outcome <span class="math inline">\(Y\)</span> based on inputs <span class="math inline">\(X\)</span> and parameters <span class="math inline">\(\theta\)</span>. Consider the following scalar inputs:</p>
<p><span class="math display">\[w: \text{the input of interest}\]</span> <span class="math display">\[c: \text{all the other inputs}\]</span> <span class="math display">\[X = (w, c)\]</span></p>
<p>In contrast to <code>comparisons</code>, for <code>slopes</code> we are interested in comparing <span class="math inline">\(w^{\text{value}}\)</span> to <span class="math inline">\(w^{\text{value}+\epsilon}\)</span> (perhaps age = 60 and 60.0001 respectively) with all other inputs <span class="math inline">\(c\)</span> held constant. The <em>predictive difference</em> in the outcome changing <strong>only</strong> <span class="math inline">\(w\)</span> is:</p>
<p><span class="math display">\[\text{average predictive difference} = \mathbb{E}(y|w^{\text{value}}, c, \theta) - \mathbb{E}(y|w^{\text{value}+\epsilon}, c, \theta)\]</span></p>
<p>Selecting <span class="math inline">\(w\)</span> and <span class="math inline">\(w^{\text{value}+\epsilon}\)</span> and averaging over all other inputs <span class="math inline">\(c\)</span> in the data gives you a new “hypothetical” dataset and corresponds to counting all pairs of transitions of <span class="math inline">\((w^\text{value})\)</span> to <span class="math inline">\((w^{\text{value}+\epsilon})\)</span>, i.e., differences in <span class="math inline">\(w\)</span> with <span class="math inline">\(c\)</span> held constant. The difference between these two terms is the average predictive difference.</p>
<p>However, to obtain the slope estimate, we need to take the above formula and divide by <span class="math inline">\(\epsilon\)</span> to obtain the <em>average predictive slope</em>:</p>
<p><span class="math display">\[\text{average predictive slope} = \frac{\mathbb{E}(y|w^{\text{value}}, c, \theta) - \mathbb{E}(y|w^{\text{value}+\epsilon}, c, \theta)}{\epsilon}\]</span></p>
</section>
<section id="computing-slopes" class="level2">
<h2 class="anchored" data-anchor-id="computing-slopes">Computing Slopes</h2>
<p>The objective of <code>slopes</code> and <code>plot_slopes</code> is to compute the rate of change (slope) in the mean of the response <span class="math inline">\(y\)</span> with respect to a small change <span class="math inline">\(\epsilon\)</span> in the predictor <span class="math inline">\(x\)</span> conditional on other covariates <span class="math inline">\(c\)</span> specified in the model. <span class="math inline">\(w\)</span> is specified by the user and the original value is either provided by the user, else a default value (the mean) is computed by Bambi. The values for the other covariates <span class="math inline">\(c\)</span> specified in the model can be determined under the following three scenarios:</p>
<ol type="1">
<li>user provided values</li>
<li>a grid of equally spaced and central values</li>
<li>empirical distribution (original data used to fit the model)</li>
</ol>
<p>In the case of (1) and (2) above, Bambi assembles all pairwise combinations (transitions) of <span class="math inline">\(w\)</span> and <span class="math inline">\(c\)</span> into a new “hypothetical” dataset. In (3), Bambi uses the original <span class="math inline">\(c\)</span>, and adds a small amount <span class="math inline">\(\epsilon\)</span> to each unit of observation’s <span class="math inline">\(w\)</span>. In each scenario, predictions are made on the data using the fitted model. Once the predictions are made, comparisons are computed using the posterior samples by taking the difference in the predicted outcome for each pair of transitions and dividing by <span class="math inline">\(\epsilon\)</span>. The average of these slopes is the average predictive slopes.</p>
<p>For variables <span class="math inline">\(w\)</span> with a string or categorical data type, the <code>comparisons</code> function is called to compute the expected difference in group means. Please refer to the <a href="https://bambinos.github.io/bambi/notebooks/plot_comparisons.html">comparisons</a> documentation for more details.</p>
<p>Below, we present several examples showing how to use Bambi to perform these computations for us, and to return either a summary dataframe, or a visualization of the results.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> arviz <span class="im">as</span> az</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> bambi <span class="im">as</span> bmb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression">Logistic Regression</h2>
<p>To demonstrate <code>slopes</code> and <code>plot_slopes</code>, we will use the <a href="https://vincentarelbundock.github.io/Rdatasets/doc/carData/Wells.html">well switching dataset</a> to model the probability a household in Bangladesh switches water wells. The data are for an area of Arahazar Upazila, Bangladesh. The researchers labelled each well with its level of arsenic and an indication of whether the well was “safe” or “unsafe”. Those using unsafe wells were encouraged to switch. After several years, it was determined whether each household using an unsafe well had changed its well. The data contains <span class="math inline">\(3020\)</span> observations on the following five variables:</p>
<ul>
<li><code>switch</code>: a factor with levels <code>no</code> and <code>yes</code> indicating whether the household switched to a new well</li>
<li><code>arsenic</code>: the level of arsenic in the old well (measured in micrograms per liter)</li>
<li><code>dist</code>: the distance to the nearest safe well (measured in meters)</li>
<li><code>assoc</code>: a factor with levels <code>no</code> and <code>yes</code> indicating whether the household is a member of an arsenic education group</li>
<li><code>educ</code>: years of education of the household head</li>
</ul>
<p>First, a logistic regression model with no interactions is fit to the data. Subsequently, to demonstrate the benefits of <code>plot_slopes</code> in interpreting interactions, we will fit a logistic regression model with an interaction term.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">"http://www.stat.columbia.edu/~gelman/arm/examples/arsenic/wells.dat"</span>, sep<span class="op">=</span><span class="st">" "</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"switch"</span>] <span class="op">=</span> pd.Categorical(data[<span class="st">"switch"</span>])</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"dist100"</span>] <span class="op">=</span> data[<span class="st">"dist"</span>] <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"educ4"</span>] <span class="op">=</span> data[<span class="st">"educ"</span>] <span class="op">/</span> <span class="dv">4</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">switch</th>
<th data-quarto-table-cell-role="th">arsenic</th>
<th data-quarto-table-cell-role="th">dist</th>
<th data-quarto-table-cell-role="th">assoc</th>
<th data-quarto-table-cell-role="th">educ</th>
<th data-quarto-table-cell-role="th">dist100</th>
<th data-quarto-table-cell-role="th">educ4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>2.36</td>
<td>16.826000</td>
<td>0</td>
<td>0</td>
<td>0.16826</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>0.71</td>
<td>47.321999</td>
<td>0</td>
<td>0</td>
<td>0.47322</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>2.07</td>
<td>20.966999</td>
<td>0</td>
<td>10</td>
<td>0.20967</td>
<td>2.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>1.15</td>
<td>21.486000</td>
<td>0</td>
<td>12</td>
<td>0.21486</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>1</td>
<td>1.10</td>
<td>40.874001</td>
<td>1</td>
<td>14</td>
<td>0.40874</td>
<td>3.5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>well_model <span class="op">=</span> bmb.Model(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"switch ~ dist100 + arsenic + educ4"</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    data,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    family<span class="op">=</span><span class="st">"bernoulli"</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>well_idata <span class="op">=</span> well_model.fit(</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    draws<span class="op">=</span><span class="dv">1000</span>, </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    target_accept<span class="op">=</span><span class="fl">0.95</span>, </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    random_seed<span class="op">=</span><span class="dv">1234</span>, </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    chains<span class="op">=</span><span class="dv">4</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Modeling the probability that switch==0
Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [Intercept, dist100, arsenic, educ4]
Sampling 4 chains for 1_000 tune and 1_000 draw iterations (4_000 + 4_000 draws total) took 3 seconds.</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="8000" class="" max="8000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [8000/8000 00:02&lt;00:00 Sampling 4 chains, 0 divergences]
    </div>
    
</div>
</div>
<section id="user-provided-values" class="level3">
<h3 class="anchored" data-anchor-id="user-provided-values">User provided values</h3>
<p>First, an example of scenario 1 (user provided values) is given below. In both <code>plot_slopes</code> and <code>slopes</code>, <span class="math inline">\(w\)</span> and <span class="math inline">\(c\)</span> are represented by <code>wrt</code> (with respect to) and <code>conditional</code>, respectively. The modeler has the ability to pass their own values for <code>wrt</code> and <code>conditional</code> by using a dictionary where the key-value pairs are the covariate and value(s) of interest.</p>
<p>For example, if we wanted to compute the slope of the probability of switching wells for a typical <code>arsenic</code> value of <span class="math inline">\(1.3\)</span> conditional on a range of <code>dist</code> and <code>educ</code> values, we would pass the following dictionary in the code block below. By default, for <span class="math inline">\(w\)</span>, Bambi compares <span class="math inline">\(w^\text{value}\)</span> to <span class="math inline">\(w^{\text{value} + \epsilon}\)</span> where <span class="math inline">\(\epsilon =\)</span> <code>1e-4</code>. However, the value for <span class="math inline">\(\epsilon\)</span> can be changed by passing a value to the argument <code>eps</code>.</p>
<p>Thus, in this example, <span class="math inline">\(w^\text{value} = 1.3\)</span> and <span class="math inline">\(w^{\text{value} + \epsilon} = 1.3001\)</span>. The user is not limited to passing a list for the values. A <code>np.array</code> can also be used. Furthermore, Bambi by default, maps the order of the dict keys to the main, group, and panel of the matplotlib figure. Below, since <code>dist100</code> is the first key, this is used for the x-axis, and <code>educ4</code> is used for the group (color). If a third key was passed, it would be used for the panel (facet).</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> bmb.interpret.plot_slopes(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    well_model,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    well_idata,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    wrt<span class="op">=</span>{<span class="st">"arsenic"</span>: <span class="fl">1.3</span>},</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    conditional<span class="op">=</span>{<span class="st">"dist100"</span>: [<span class="fl">0.20</span>, <span class="fl">0.50</span>, <span class="fl">0.80</span>], <span class="st">"educ4"</span>: [<span class="fl">1.00</span>, <span class="fl">1.20</span>, <span class="fl">2.00</span>]},</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">7</span>, <span class="dv">3</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>fig.axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Slope of Well Switching Probability"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-gsoc-update-slopes_files/figure-html/cell-5-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The plot above shows that, for example, conditional on <code>dist100</code> <span class="math inline">\(= 0.2\)</span> and <code>educ4</code> <span class="math inline">\(= 1.0\)</span> a unit increase in <code>arsenic</code> is associated with households being <span class="math inline">\(11\)</span>% less likely to switch wells. Notice that even though we fit a logistic regression model where the coefficients are on the log-odds scale, the <code>slopes</code> function returns the slope on the probability scale. Thus, we can interpret the y-axis (slope) as the expected change in the probability of switching wells for a unit increase in <code>arsenic</code> conditional on the specified covariates.</p>
<p><code>slopes</code> can be called directly to view a summary dataframe that includes the term name, estimate type (discussed in detail in the <em>interpreting coefficients as an elasticity</em> section), values <span class="math inline">\(w\)</span> used to compute the estimate, the specified conditional covariates <span class="math inline">\(c\)</span>, and the expected slope of the outcome with the uncertainty interval (by default the <span class="math inline">\(94\)</span>% highest density interval is computed).</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>bmb.interpret.slopes(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    well_model,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    well_idata,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    wrt<span class="op">=</span>{<span class="st">"arsenic"</span>: <span class="fl">1.5</span>},</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    conditional<span class="op">=</span>{</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"dist100"</span>: [<span class="fl">0.20</span>, <span class="fl">0.50</span>, <span class="fl">0.80</span>], </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"educ4"</span>: [<span class="fl">1.00</span>, <span class="fl">1.20</span>, <span class="fl">2.00</span>]</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">term</th>
<th data-quarto-table-cell-role="th">estimate_type</th>
<th data-quarto-table-cell-role="th">value</th>
<th data-quarto-table-cell-role="th">dist100</th>
<th data-quarto-table-cell-role="th">educ4</th>
<th data-quarto-table-cell-role="th">estimate</th>
<th data-quarto-table-cell-role="th">lower_3.0%</th>
<th data-quarto-table-cell-role="th">upper_97.0%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>arsenic</td>
<td>dydx</td>
<td>(1.5, 1.5001)</td>
<td>0.2</td>
<td>1.0</td>
<td>-0.110797</td>
<td>-0.128775</td>
<td>-0.092806</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>arsenic</td>
<td>dydx</td>
<td>(1.5, 1.5001)</td>
<td>0.2</td>
<td>1.2</td>
<td>-0.109867</td>
<td>-0.126725</td>
<td>-0.091065</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>arsenic</td>
<td>dydx</td>
<td>(1.5, 1.5001)</td>
<td>0.2</td>
<td>2.0</td>
<td>-0.105618</td>
<td>-0.122685</td>
<td>-0.088383</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>arsenic</td>
<td>dydx</td>
<td>(1.5, 1.5001)</td>
<td>0.5</td>
<td>1.0</td>
<td>-0.116087</td>
<td>-0.134965</td>
<td>-0.096843</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>arsenic</td>
<td>dydx</td>
<td>(1.5, 1.5001)</td>
<td>0.5</td>
<td>1.2</td>
<td>-0.115632</td>
<td>-0.134562</td>
<td>-0.096543</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>arsenic</td>
<td>dydx</td>
<td>(1.5, 1.5001)</td>
<td>0.5</td>
<td>2.0</td>
<td>-0.113140</td>
<td>-0.130448</td>
<td>-0.093209</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>arsenic</td>
<td>dydx</td>
<td>(1.5, 1.5001)</td>
<td>0.8</td>
<td>1.0</td>
<td>-0.117262</td>
<td>-0.136850</td>
<td>-0.098549</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>arsenic</td>
<td>dydx</td>
<td>(1.5, 1.5001)</td>
<td>0.8</td>
<td>1.2</td>
<td>-0.117347</td>
<td>-0.136475</td>
<td>-0.098044</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>arsenic</td>
<td>dydx</td>
<td>(1.5, 1.5001)</td>
<td>0.8</td>
<td>2.0</td>
<td>-0.116957</td>
<td>-0.135079</td>
<td>-0.096476</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Since all covariates used to fit the model were also specified to compute the slopes, no default value is used for unspecified covariates. A default value is computed for the unspecified covariates because in order to peform predictions, Bambi is expecting a value for each covariate used to fit the model. Additionally, with GLM models, average predictive slopes are conditional in the sense that the estimate depends on the values of <strong>all</strong> the covariates in the model. Thus, for unspecified covariates, <code>slopes</code> and <code>plot_slopes</code> computes a default value (mean or mode based on the data type of the covariate). Each row in the summary dataframe is read as “the slope (or rate of change) of the probability of switching wells with respect to a small change in <span class="math inline">\(w\)</span> conditional on <span class="math inline">\(c\)</span> is <span class="math inline">\(y\)</span>”.</p>
</section>
<section id="multiple-slope-values" class="level3">
<h3 class="anchored" data-anchor-id="multiple-slope-values">Multiple slope values</h3>
<p>Users can also compute slopes on multiple values for <code>wrt</code>. For example, if we want to compute the slope of <span class="math inline">\(y\)</span> with respect to <code>arsenic</code> <span class="math inline">\(= 1.5\)</span>, <span class="math inline">\(2.0\)</span>, and <span class="math inline">\(2.5\)</span>, simply pass a list or numpy array as the dictionary values for <code>wrt</code>. Keeping the conditional covariate and values the same, the following slope estimates are computed below.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>multiple_values <span class="op">=</span> bmb.interpret.slopes(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    well_model,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    well_idata,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    wrt<span class="op">=</span>{<span class="st">"arsenic"</span>: [<span class="fl">1.5</span>, <span class="fl">2.0</span>, <span class="fl">2.5</span>]},</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    conditional<span class="op">=</span>{</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"dist100"</span>: [<span class="fl">0.20</span>, <span class="fl">0.50</span>, <span class="fl">0.80</span>], </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"educ4"</span>: [<span class="fl">1.00</span>, <span class="fl">1.20</span>, <span class="fl">2.00</span>]</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>multiple_values.head(<span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">term</th>
<th data-quarto-table-cell-role="th">estimate_type</th>
<th data-quarto-table-cell-role="th">value</th>
<th data-quarto-table-cell-role="th">dist100</th>
<th data-quarto-table-cell-role="th">educ4</th>
<th data-quarto-table-cell-role="th">estimate</th>
<th data-quarto-table-cell-role="th">lower_3.0%</th>
<th data-quarto-table-cell-role="th">upper_97.0%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>arsenic</td>
<td>dydx</td>
<td>(1.5, 1.5001)</td>
<td>0.2</td>
<td>1.0</td>
<td>-0.110797</td>
<td>-0.128775</td>
<td>-0.092806</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>arsenic</td>
<td>dydx</td>
<td>(2.0, 2.0001)</td>
<td>0.2</td>
<td>1.0</td>
<td>-0.109867</td>
<td>-0.126725</td>
<td>-0.091065</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>arsenic</td>
<td>dydx</td>
<td>(2.5, 2.5001)</td>
<td>0.2</td>
<td>1.0</td>
<td>-0.105618</td>
<td>-0.122685</td>
<td>-0.088383</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>arsenic</td>
<td>dydx</td>
<td>(1.5, 1.5001)</td>
<td>0.2</td>
<td>1.2</td>
<td>-0.116087</td>
<td>-0.134965</td>
<td>-0.096843</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>arsenic</td>
<td>dydx</td>
<td>(2.0, 2.0001)</td>
<td>0.2</td>
<td>1.2</td>
<td>-0.115632</td>
<td>-0.134562</td>
<td>-0.096543</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>arsenic</td>
<td>dydx</td>
<td>(2.5, 2.5001)</td>
<td>0.2</td>
<td>1.2</td>
<td>-0.113140</td>
<td>-0.130448</td>
<td>-0.093209</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The output above is essentially the same as the summary dataframe when we only passed one value to <code>wrt</code>. However, now each element (value) in the list gets a small amount <span class="math inline">\(\epsilon\)</span> added to it, and the slope is calculated for each of these values.</p>
</section>
<section id="conditional-slopes" class="level3">
<h3 class="anchored" data-anchor-id="conditional-slopes">Conditional slopes</h3>
<p>As stated in the <em>interpreting interaction effects</em> section, interpreting coefficients of multiple interaction terms can be difficult and cumbersome. Thus, <code>plot_slopes</code> provides an effective way to visualize the conditional slopes of the interaction effects. Below, we will use the same well switching dataset, but with interaction terms. Specifically, one interaction is added between <code>dist100</code> and <code>educ4</code>, and another between <code>arsenic</code> and <code>educ4</code>.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>well_model_interact <span class="op">=</span> bmb.Model(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"switch ~ dist100 + arsenic + educ4 + dist100:educ4 + arsenic:educ4"</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    data,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    family<span class="op">=</span><span class="st">"bernoulli"</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>well_idata_interact <span class="op">=</span> well_model_interact.fit(</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    draws<span class="op">=</span><span class="dv">1000</span>, </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    target_accept<span class="op">=</span><span class="fl">0.95</span>, </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    random_seed<span class="op">=</span><span class="dv">1234</span>, </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    chains<span class="op">=</span><span class="dv">4</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Modeling the probability that switch==0
Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [Intercept, dist100, arsenic, educ4, dist100:educ4, arsenic:educ4]
Sampling 4 chains for 1_000 tune and 1_000 draw iterations (4_000 + 4_000 draws total) took 15 seconds.</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="8000" class="" max="8000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [8000/8000 00:15&lt;00:00 Sampling 4 chains, 0 divergences]
    </div>
    
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary of coefficients</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>az.summary(well_idata_interact)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">sd</th>
<th data-quarto-table-cell-role="th">hdi_3%</th>
<th data-quarto-table-cell-role="th">hdi_97%</th>
<th data-quarto-table-cell-role="th">mcse_mean</th>
<th data-quarto-table-cell-role="th">mcse_sd</th>
<th data-quarto-table-cell-role="th">ess_bulk</th>
<th data-quarto-table-cell-role="th">ess_tail</th>
<th data-quarto-table-cell-role="th">r_hat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Intercept</td>
<td>-0.097</td>
<td>0.122</td>
<td>-0.322</td>
<td>0.137</td>
<td>0.003</td>
<td>0.002</td>
<td>2259.0</td>
<td>2203.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">dist100</td>
<td>1.320</td>
<td>0.175</td>
<td>0.982</td>
<td>1.640</td>
<td>0.004</td>
<td>0.003</td>
<td>2085.0</td>
<td>2457.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">arsenic</td>
<td>-0.398</td>
<td>0.061</td>
<td>-0.521</td>
<td>-0.291</td>
<td>0.001</td>
<td>0.001</td>
<td>2141.0</td>
<td>2558.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">educ4</td>
<td>0.102</td>
<td>0.080</td>
<td>-0.053</td>
<td>0.246</td>
<td>0.002</td>
<td>0.001</td>
<td>1935.0</td>
<td>2184.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">dist100:educ4</td>
<td>-0.330</td>
<td>0.106</td>
<td>-0.528</td>
<td>-0.136</td>
<td>0.002</td>
<td>0.002</td>
<td>2070.0</td>
<td>2331.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">arsenic:educ4</td>
<td>-0.079</td>
<td>0.043</td>
<td>-0.161</td>
<td>-0.000</td>
<td>0.001</td>
<td>0.001</td>
<td>2006.0</td>
<td>2348.0</td>
<td>1.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The coefficients of the linear model are shown in the table above. The interaction coefficents indicate the slope varies in a continuous fashion with the continuous variable.</p>
<p>A negative value for <code>arsenic:dist100</code> indicates that the “effect” of arsenic on the outcome is less negative as distance from the well increases. Similarly, a negative value for <code>arsenic:educ4</code> indicates that the “effect” of arsenic on the outcome is more negative as education increases. Remember, these coefficients are still on the logit scale. Furthermore, as more variables and interaction terms are added to the model, interpreting these coefficients becomes more difficult.</p>
<p>Thus, lets use <code>plot_slopes</code> to visually see how the slope changes with respect to <code>arsenic</code> conditional on <code>dist100</code> and <code>educ4</code> changing. Notice in the code block below how parameters are passed to the <code>subplot_kwargs</code> and <code>fig_kwargs</code> arguments. At times, it can be useful to pass specific <code>group</code> and <code>panel</code> arguments to aid in the interpretation of the plot. Therefore, <code>subplot_kwargs</code> allows the user to manipulate the plotting by passing a dictionary where the keys are <code>{"main": ..., "group": ..., "panel": ...}</code> and the values are the names of the covariates to be plotted. <code>fig_kwargs</code> are figure level key word arguments such as <code>figsize</code> and <code>sharey</code>.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> bmb.interpret.plot_slopes(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    well_model_interact,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    well_idata_interact,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    wrt<span class="op">=</span><span class="st">"arsenic"</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    conditional<span class="op">=</span>[<span class="st">"dist100"</span>, <span class="st">"educ4"</span>],</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    subplot_kwargs<span class="op">=</span>{<span class="st">"main"</span>: <span class="st">"dist100"</span>, <span class="st">"group"</span>: <span class="st">"educ4"</span>, <span class="st">"panel"</span>: <span class="st">"educ4"</span>},</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    fig_kwargs<span class="op">=</span>{<span class="st">"figsize"</span>: (<span class="dv">16</span>, <span class="dv">4</span>), <span class="st">"sharey"</span>: <span class="va">True</span>},</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">False</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-gsoc-update-slopes_files/figure-html/cell-10-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>With interaction terms now defined, it can be seen how the slope of the outcome with respect to <code>arsenic</code> differ depending on the value of <code>educ4</code>. Especially in the case of <code>educ4</code> <span class="math inline">\(= 4.25\)</span>, the slope is more “constant”, but with greater uncertainty. Lets compare this with the model that does not include any interaction terms.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> bmb.interpret.plot_slopes(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    well_model,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    well_idata,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    wrt<span class="op">=</span><span class="st">"arsenic"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    conditional<span class="op">=</span>[<span class="st">"dist100"</span>, <span class="st">"educ4"</span>],</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    subplot_kwargs<span class="op">=</span>{<span class="st">"main"</span>: <span class="st">"dist100"</span>, <span class="st">"group"</span>: <span class="st">"educ4"</span>, <span class="st">"panel"</span>: <span class="st">"educ4"</span>},</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    fig_kwargs<span class="op">=</span>{<span class="st">"figsize"</span>: (<span class="dv">16</span>, <span class="dv">4</span>), <span class="st">"sharey"</span>: <span class="va">True</span>},</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">False</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-gsoc-update-slopes_files/figure-html/cell-11-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>For the non-interaction model, conditional on a range of values for <code>educ4</code> and <code>dist100</code>, the slopes of the outcome are nearly identical.</p>
</section>
<section id="unit-level-slopes" class="level3">
<h3 class="anchored" data-anchor-id="unit-level-slopes">Unit level slopes</h3>
<p>Evaluating average predictive slopes at central values for the conditional covariates <span class="math inline">\(c\)</span> can be problematic when the inputs have a large variance since no single central value (mean, median, etc.) is representative of the covariate. This is especially true when <span class="math inline">\(c\)</span> exhibits bi or multimodality. Thus, it may be desireable to use the empirical distribution of <span class="math inline">\(c\)</span> to compute the predictive slopes, and then average over a specific or set of covariates to obtain average slopes. To achieve unit level slopes, do not pass a parameter into <code>conditional</code> and or specify <code>None</code>.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>unit_level <span class="op">=</span> bmb.interpret.slopes(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    well_model_interact,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    well_idata_interact,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    wrt<span class="op">=</span><span class="st">"arsenic"</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    conditional<span class="op">=</span><span class="va">None</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># empirical distribution</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(unit_level.shape[<span class="dv">0</span>] <span class="op">==</span> well_model_interact.data.shape[<span class="dv">0</span>])</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>unit_level.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">term</th>
<th data-quarto-table-cell-role="th">estimate_type</th>
<th data-quarto-table-cell-role="th">value</th>
<th data-quarto-table-cell-role="th">dist100</th>
<th data-quarto-table-cell-role="th">educ4</th>
<th data-quarto-table-cell-role="th">estimate</th>
<th data-quarto-table-cell-role="th">lower_3.0%</th>
<th data-quarto-table-cell-role="th">upper_97.0%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>arsenic</td>
<td>dydx</td>
<td>(2.36, 2.3601)</td>
<td>0.16826</td>
<td>0.00</td>
<td>-0.084280</td>
<td>-0.105566</td>
<td>-0.063403</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>arsenic</td>
<td>dydx</td>
<td>(0.71, 0.7101)</td>
<td>0.47322</td>
<td>0.00</td>
<td>-0.097837</td>
<td>-0.125057</td>
<td>-0.070959</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>arsenic</td>
<td>dydx</td>
<td>(2.07, 2.0701)</td>
<td>0.20967</td>
<td>2.50</td>
<td>-0.118093</td>
<td>-0.139848</td>
<td>-0.093442</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>arsenic</td>
<td>dydx</td>
<td>(1.15, 1.1501)</td>
<td>0.21486</td>
<td>3.00</td>
<td>-0.150638</td>
<td>-0.194765</td>
<td>-0.108946</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>arsenic</td>
<td>dydx</td>
<td>(1.1, 1.1001)</td>
<td>0.40874</td>
<td>3.50</td>
<td>-0.161272</td>
<td>-0.214761</td>
<td>-0.108663</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>arsenic</td>
<td>dydx</td>
<td>(3.9, 3.9001)</td>
<td>0.69518</td>
<td>2.25</td>
<td>-0.073908</td>
<td>-0.080525</td>
<td>-0.067493</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>arsenic</td>
<td>dydx</td>
<td>(2.97, 2.9701000000000004)</td>
<td>0.80711</td>
<td>1.00</td>
<td>-0.108482</td>
<td>-0.123517</td>
<td>-0.093042</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>arsenic</td>
<td>dydx</td>
<td>(3.24, 3.2401000000000004)</td>
<td>0.55146</td>
<td>2.50</td>
<td>-0.088049</td>
<td>-0.097939</td>
<td>-0.078020</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>arsenic</td>
<td>dydx</td>
<td>(3.28, 3.2801)</td>
<td>0.52647</td>
<td>0.00</td>
<td>-0.087388</td>
<td>-0.107331</td>
<td>-0.068076</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>arsenic</td>
<td>dydx</td>
<td>(2.52, 2.5201000000000002)</td>
<td>0.75072</td>
<td>0.00</td>
<td>-0.099035</td>
<td>-0.129517</td>
<td>-0.073222</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>well_model_interact.data.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">switch</th>
<th data-quarto-table-cell-role="th">arsenic</th>
<th data-quarto-table-cell-role="th">dist</th>
<th data-quarto-table-cell-role="th">assoc</th>
<th data-quarto-table-cell-role="th">educ</th>
<th data-quarto-table-cell-role="th">dist100</th>
<th data-quarto-table-cell-role="th">educ4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>2.36</td>
<td>16.826000</td>
<td>0</td>
<td>0</td>
<td>0.16826</td>
<td>0.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>0.71</td>
<td>47.321999</td>
<td>0</td>
<td>0</td>
<td>0.47322</td>
<td>0.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>2.07</td>
<td>20.966999</td>
<td>0</td>
<td>10</td>
<td>0.20967</td>
<td>2.50</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>1.15</td>
<td>21.486000</td>
<td>0</td>
<td>12</td>
<td>0.21486</td>
<td>3.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>1</td>
<td>1.10</td>
<td>40.874001</td>
<td>1</td>
<td>14</td>
<td>0.40874</td>
<td>3.50</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>1</td>
<td>3.90</td>
<td>69.517998</td>
<td>1</td>
<td>9</td>
<td>0.69518</td>
<td>2.25</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>1</td>
<td>2.97</td>
<td>80.710999</td>
<td>1</td>
<td>4</td>
<td>0.80711</td>
<td>1.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>1</td>
<td>3.24</td>
<td>55.146000</td>
<td>0</td>
<td>10</td>
<td>0.55146</td>
<td>2.50</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>1</td>
<td>3.28</td>
<td>52.646999</td>
<td>1</td>
<td>0</td>
<td>0.52647</td>
<td>0.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>1</td>
<td>2.52</td>
<td>75.071999</td>
<td>1</td>
<td>0</td>
<td>0.75072</td>
<td>0.00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Above, <code>unit_level</code> is the slopes summary dataframe and <code>well_model_interact.data</code> is the empirical data used to fit the model. Notice how the values for <span class="math inline">\(c\)</span> are identical in both dataframes. However, for <span class="math inline">\(w\)</span>, the values are the original <span class="math inline">\(w\)</span> value plus <span class="math inline">\(\epsilon\)</span>. Thus, the <code>estimate</code> value represents the instantaneous rate of change for that unit of observation. However, these unit level slopes are difficult to interpret since each row may have a different slope estimate. Therefore, it is useful to average over (marginalize) the estimates to summarize the unit level predictive slopes.</p>
<section id="marginalizing-over-covariates" class="level4">
<h4 class="anchored" data-anchor-id="marginalizing-over-covariates">Marginalizing over covariates</h4>
<p>Since the empirical distrubution is used for computing the average predictive slopes, the same number of rows (<span class="math inline">\(3020\)</span>) is returned as the data used to fit the model. To average over a covariate, use the <code>average_by</code> argument. If <code>True</code> is passed, then <code>slopes</code> averages over all covariates. Else, if a single or list of covariates are passed, then <code>slopes</code> averages by the covariates passed.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>bmb.interpret.slopes(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    well_model_interact,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    well_idata_interact,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    wrt<span class="op">=</span><span class="st">"arsenic"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    conditional<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    average_by<span class="op">=</span><span class="va">True</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">term</th>
<th data-quarto-table-cell-role="th">estimate_type</th>
<th data-quarto-table-cell-role="th">estimate</th>
<th data-quarto-table-cell-role="th">lower_3.0%</th>
<th data-quarto-table-cell-role="th">upper_97.0%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>arsenic</td>
<td>dydx</td>
<td>-0.111342</td>
<td>-0.134846</td>
<td>-0.088171</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The code block above is equivalent to taking the mean of the <code>estimate</code> and uncertainty columns. For example:</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>unit_level[[<span class="st">"estimate"</span>, <span class="st">"lower_3.0%"</span>, <span class="st">"upper_97.0%"</span>]].mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>estimate      -0.111342
lower_3.0%    -0.134846
upper_97.0%   -0.088171
dtype: float64</code></pre>
</div>
</div>
</section>
<section id="average-by-subgroups" class="level4">
<h4 class="anchored" data-anchor-id="average-by-subgroups">Average by subgroups</h4>
<p>Averaging over all covariates may not be desired, and you would rather average by a group or specific covariate. To perform averaging by subgroups, users can pass a single or list of covariates to <code>average_by</code> to average over specific covariates. For example, if we wanted to average by <code>educ4</code>:</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># average by educ4</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>bmb.interpret.slopes(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    well_model_interact,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    well_idata_interact,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    wrt<span class="op">=</span><span class="st">"arsenic"</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    conditional<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    average_by<span class="op">=</span><span class="st">"educ4"</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">term</th>
<th data-quarto-table-cell-role="th">estimate_type</th>
<th data-quarto-table-cell-role="th">educ4</th>
<th data-quarto-table-cell-role="th">estimate</th>
<th data-quarto-table-cell-role="th">lower_3.0%</th>
<th data-quarto-table-cell-role="th">upper_97.0%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>arsenic</td>
<td>dydx</td>
<td>0.00</td>
<td>-0.092389</td>
<td>-0.119320</td>
<td>-0.068167</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>arsenic</td>
<td>dydx</td>
<td>0.25</td>
<td>-0.101704</td>
<td>-0.126096</td>
<td>-0.076910</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>arsenic</td>
<td>dydx</td>
<td>0.50</td>
<td>-0.102112</td>
<td>-0.122443</td>
<td>-0.082142</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>arsenic</td>
<td>dydx</td>
<td>0.75</td>
<td>-0.106004</td>
<td>-0.124247</td>
<td>-0.088132</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>arsenic</td>
<td>dydx</td>
<td>1.00</td>
<td>-0.110580</td>
<td>-0.127803</td>
<td>-0.093221</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>arsenic</td>
<td>dydx</td>
<td>1.25</td>
<td>-0.112334</td>
<td>-0.128771</td>
<td>-0.094870</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>arsenic</td>
<td>dydx</td>
<td>1.50</td>
<td>-0.114875</td>
<td>-0.132652</td>
<td>-0.096790</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>arsenic</td>
<td>dydx</td>
<td>1.75</td>
<td>-0.122557</td>
<td>-0.142921</td>
<td>-0.101423</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>arsenic</td>
<td>dydx</td>
<td>2.00</td>
<td>-0.125187</td>
<td>-0.148096</td>
<td>-0.101350</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>arsenic</td>
<td>dydx</td>
<td>2.25</td>
<td>-0.125367</td>
<td>-0.150676</td>
<td>-0.099852</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>arsenic</td>
<td>dydx</td>
<td>2.50</td>
<td>-0.130748</td>
<td>-0.159912</td>
<td>-0.101058</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>arsenic</td>
<td>dydx</td>
<td>2.75</td>
<td>-0.137422</td>
<td>-0.170662</td>
<td>-0.102995</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>arsenic</td>
<td>dydx</td>
<td>3.00</td>
<td>-0.136103</td>
<td>-0.172119</td>
<td>-0.099548</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>arsenic</td>
<td>dydx</td>
<td>3.25</td>
<td>-0.156941</td>
<td>-0.202215</td>
<td>-0.107625</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>arsenic</td>
<td>dydx</td>
<td>3.50</td>
<td>-0.142571</td>
<td>-0.186079</td>
<td>-0.098362</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>arsenic</td>
<td>dydx</td>
<td>3.75</td>
<td>-0.138336</td>
<td>-0.181042</td>
<td>-0.093120</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>arsenic</td>
<td>dydx</td>
<td>4.00</td>
<td>-0.138152</td>
<td>-0.185974</td>
<td>-0.089611</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>arsenic</td>
<td>dydx</td>
<td>4.25</td>
<td>-0.176623</td>
<td>-0.244273</td>
<td>-0.107141</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># average by both educ4 and dist100</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>bmb.interpret.slopes(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    well_model_interact,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    well_idata_interact,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    wrt<span class="op">=</span><span class="st">"arsenic"</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    conditional<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    average_by<span class="op">=</span>[<span class="st">"educ4"</span>, <span class="st">"dist100"</span>]</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">term</th>
<th data-quarto-table-cell-role="th">estimate_type</th>
<th data-quarto-table-cell-role="th">educ4</th>
<th data-quarto-table-cell-role="th">dist100</th>
<th data-quarto-table-cell-role="th">estimate</th>
<th data-quarto-table-cell-role="th">lower_3.0%</th>
<th data-quarto-table-cell-role="th">upper_97.0%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>arsenic</td>
<td>dydx</td>
<td>0.00</td>
<td>0.00591</td>
<td>-0.085861</td>
<td>-0.109133</td>
<td>-0.061614</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>arsenic</td>
<td>dydx</td>
<td>0.00</td>
<td>0.02409</td>
<td>-0.096272</td>
<td>-0.127518</td>
<td>-0.069670</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>arsenic</td>
<td>dydx</td>
<td>0.00</td>
<td>0.02454</td>
<td>-0.056617</td>
<td>-0.065433</td>
<td>-0.046970</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>arsenic</td>
<td>dydx</td>
<td>0.00</td>
<td>0.02791</td>
<td>-0.097646</td>
<td>-0.128131</td>
<td>-0.069660</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>arsenic</td>
<td>dydx</td>
<td>0.00</td>
<td>0.03252</td>
<td>-0.076300</td>
<td>-0.095832</td>
<td>-0.057900</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2992</td>
<td>arsenic</td>
<td>dydx</td>
<td>4.00</td>
<td>1.13727</td>
<td>-0.070078</td>
<td>-0.094698</td>
<td>-0.046623</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2993</td>
<td>arsenic</td>
<td>dydx</td>
<td>4.00</td>
<td>1.14418</td>
<td>-0.125547</td>
<td>-0.172943</td>
<td>-0.075368</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2994</td>
<td>arsenic</td>
<td>dydx</td>
<td>4.00</td>
<td>1.25308</td>
<td>-0.156780</td>
<td>-0.218836</td>
<td>-0.088258</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2995</td>
<td>arsenic</td>
<td>dydx</td>
<td>4.00</td>
<td>1.67025</td>
<td>-0.161465</td>
<td>-0.227211</td>
<td>-0.085394</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2996</td>
<td>arsenic</td>
<td>dydx</td>
<td>4.25</td>
<td>0.29633</td>
<td>-0.176623</td>
<td>-0.244273</td>
<td>-0.107141</td>
</tr>
</tbody>
</table>

<p>2997 rows × 7 columns</p>
</div>
</div>
</div>
<p>It is still possible to use <code>plot_slopes</code> when passing an argument to <code>average_by</code>. In the plot below, the empirical distribution is used to compute unit level slopes with respect to <code>arsenic</code> and then averaged over <code>educ4</code> to obtain the average predictive slopes.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> bmb.interpret.plot_slopes(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    well_model_interact,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    well_idata_interact,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    wrt<span class="op">=</span><span class="st">"arsenic"</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    conditional<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    average_by<span class="op">=</span><span class="st">"educ4"</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">7</span>, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-gsoc-update-slopes_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="interpreting-coefficients-as-an-elasticity" class="level3">
<h3 class="anchored" data-anchor-id="interpreting-coefficients-as-an-elasticity">Interpreting coefficients as an elasticity</h3>
<p>In some fields, such as economics, it is useful to interpret the results of a regression model in terms of an elasticity (a percent change in <span class="math inline">\(x\)</span> is associated with a percent change in <span class="math inline">\(y\)</span>) or semi-elasticity (a unit change in <span class="math inline">\(x\)</span> is associated with a percent change in <span class="math inline">\(y\)</span>, or vice versa). Typically, this is achieved by fitting a model where either the outcome and or the covariates are log-transformed. However, since the log transformation is performed by the modeler, to compute elasticities for <code>slopes</code> and <code>plot_slopes</code>, Bambi “post-processes” the predictions to compute the elasticities. Below, it is shown the possible elasticity arguments and how they are computed for <code>slopes</code> and <code>plot_slopes</code>:</p>
<ul>
<li><code>eyex</code>: a percentage point increase in <span class="math inline">\(x_1\)</span> is associated with an <span class="math inline">\(n\)</span> percentage point increase in <span class="math inline">\(y\)</span></li>
</ul>
<p><span class="math display">\[\frac{\partial \hat{y}}{\partial x_1} * \frac{x_1}{\hat{y}}\]</span></p>
<ul>
<li><code>eydx</code>: a unit increase in <span class="math inline">\(x_1\)</span> is associated with an <span class="math inline">\(n\)</span> percentage point increase in <span class="math inline">\(y\)</span></li>
</ul>
<p><span class="math display">\[\frac{\partial \hat{y}}{\partial x_1} * \frac{1}{\hat{y}}\]</span></p>
<ul>
<li><code>dyex</code>: a percentage point increase in <span class="math inline">\(x_1\)</span> is associated with an <span class="math inline">\(n\)</span> unit increase in <span class="math inline">\(y\)</span></li>
</ul>
<p><span class="math display">\[\frac{\partial \hat{y}}{\partial x_1} * x_1\]</span></p>
<p>Below, each code cell shows the same model, and <code>wrt</code> and <code>conditional</code> argument, but with a different elasticity (<code>slope</code>) argument. By default, <code>dydx</code> (a derivative with no post-processing) is used.</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>bmb.interpret.slopes(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    well_model_interact,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    well_idata_interact,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    wrt<span class="op">=</span><span class="st">"arsenic"</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    slope<span class="op">=</span><span class="st">"eyex"</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    conditional<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    average_by<span class="op">=</span><span class="va">True</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">term</th>
<th data-quarto-table-cell-role="th">estimate_type</th>
<th data-quarto-table-cell-role="th">estimate</th>
<th data-quarto-table-cell-role="th">lower_3.0%</th>
<th data-quarto-table-cell-role="th">upper_97.0%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>arsenic</td>
<td>eyex</td>
<td>-0.525124</td>
<td>-0.652708</td>
<td>-0.396082</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>bmb.interpret.slopes(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    well_model_interact,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    well_idata_interact,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    wrt<span class="op">=</span><span class="st">"arsenic"</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    slope<span class="op">=</span><span class="st">"eydx"</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    conditional<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    average_by<span class="op">=</span><span class="va">True</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">term</th>
<th data-quarto-table-cell-role="th">estimate_type</th>
<th data-quarto-table-cell-role="th">estimate</th>
<th data-quarto-table-cell-role="th">lower_3.0%</th>
<th data-quarto-table-cell-role="th">upper_97.0%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>arsenic</td>
<td>eydx</td>
<td>-0.286753</td>
<td>-0.351592</td>
<td>-0.220459</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>bmb.interpret.slopes(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    well_model_interact,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    well_idata_interact,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    wrt<span class="op">=</span><span class="st">"arsenic"</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    slope<span class="op">=</span><span class="st">"dyex"</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    conditional<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    average_by<span class="op">=</span><span class="va">True</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">term</th>
<th data-quarto-table-cell-role="th">estimate_type</th>
<th data-quarto-table-cell-role="th">estimate</th>
<th data-quarto-table-cell-role="th">lower_3.0%</th>
<th data-quarto-table-cell-role="th">upper_97.0%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>arsenic</td>
<td>dyex</td>
<td>-0.167616</td>
<td>-0.201147</td>
<td>-0.134605</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><code>slope</code> is also an argument for <code>plot_slopes</code>. Below, we visualize the elasticity with respect to <code>arsenic</code> conditional on a range of <code>dist100</code> and <code>educ4</code> values (notice this is the same plot as in the <em>conditional slopes</em> section).</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> bmb.interpret.plot_slopes(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    well_model_interact,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    well_idata_interact,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    wrt<span class="op">=</span><span class="st">"arsenic"</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    conditional<span class="op">=</span>[<span class="st">"dist100"</span>, <span class="st">"educ4"</span>],</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    slope<span class="op">=</span><span class="st">"eyex"</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    subplot_kwargs<span class="op">=</span>{<span class="st">"main"</span>: <span class="st">"dist100"</span>, <span class="st">"group"</span>: <span class="st">"educ4"</span>, <span class="st">"panel"</span>: <span class="st">"educ4"</span>},</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    fig_kwargs<span class="op">=</span>{<span class="st">"figsize"</span>: (<span class="dv">16</span>, <span class="dv">4</span>), <span class="st">"sharey"</span>: <span class="va">True</span>},</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">False</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-gsoc-update-slopes_files/figure-html/cell-22-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="categorical-covariates" class="level3">
<h3 class="anchored" data-anchor-id="categorical-covariates">Categorical covariates</h3>
<p>As mentioned in the <em>computing slopes</em> section, if you pass a variable with a string or categorical data type, the <code>comparisons</code> function will be called to compute the expected difference in group means. Here, we fit the same interaction model as above, albeit, by specifying <code>educ4</code> as an ordinal data type.</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">"http://www.stat.columbia.edu/~gelman/arm/examples/arsenic/wells.dat"</span>, sep<span class="op">=</span><span class="st">" "</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"switch"</span>] <span class="op">=</span> pd.Categorical(data[<span class="st">"switch"</span>])</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"dist100"</span>] <span class="op">=</span> data[<span class="st">"dist"</span>] <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"educ4"</span>] <span class="op">=</span> pd.Categorical(data[<span class="st">"educ"</span>] <span class="op">/</span> <span class="dv">4</span>, ordered<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>well_model_interact <span class="op">=</span> bmb.Model(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"switch ~ dist100 + arsenic + educ4 + dist100:educ4 + arsenic:educ4"</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    data,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    family<span class="op">=</span><span class="st">"bernoulli"</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>well_idata_interact <span class="op">=</span> well_model_interact.fit(</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    draws<span class="op">=</span><span class="dv">1000</span>, </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    target_accept<span class="op">=</span><span class="fl">0.95</span>, </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    random_seed<span class="op">=</span><span class="dv">1234</span>, </span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    chains<span class="op">=</span><span class="dv">4</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Modeling the probability that switch==0
Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [Intercept, dist100, arsenic, educ4, dist100:educ4, arsenic:educ4]
Sampling 4 chains for 1_000 tune and 1_000 draw iterations (4_000 + 4_000 draws total) took 319 seconds.</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="8000" class="" max="8000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [8000/8000 05:18&lt;00:00 Sampling 4 chains, 0 divergences]
    </div>
    
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> bmb.interpret.plot_slopes(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    well_model_interact,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    well_idata_interact,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    wrt<span class="op">=</span><span class="st">"educ4"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    conditional<span class="op">=</span><span class="st">"dist100"</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    average_by<span class="op">=</span><span class="st">"dist100"</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">7</span>, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-gsoc-update-slopes_files/figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>As the model was fit with <code>educ4</code> as a categorical data type, Bambi recognized this, and calls <code>comparisons</code> to compute the differences between each level of <code>educ4</code>. As <code>educ4</code> contains many category levels, a covariate must be passed to <code>average_by</code> in order to perform plotting. Below, we can see this plot is equivalent to <code>plot_comparisons</code>.</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> bmb.interpret.plot_comparisons(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    well_model_interact,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    well_idata_interact,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    contrast<span class="op">=</span><span class="st">"educ4"</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    conditional<span class="op">=</span><span class="st">"dist100"</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    average_by<span class="op">=</span><span class="st">"dist100"</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">7</span>, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-gsoc-update-slopes_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>However, computing the predictive difference between each <code>educ4</code> level may not be desired. Thus, in <code>plot_slopes</code>, as in <code>plot_comparisons</code>, if <code>wrt</code> is a categorical or string data type, it is possible to specify the <code>wrt</code> values. For example, if we wanted to compute the expected difference in probability of switching wells for when <code>educ4</code> is <span class="math inline">\(4\)</span> versus <span class="math inline">\(1\)</span> conditional on a range of <code>dist100</code> and <code>arsenic</code> values, we would pass the following dictionary in the code block below. Please refer to the <a href="https://bambinos.github.io/bambi/notebooks/plot_comparisons.html">comparisons</a> documentation for more details.</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> bmb.interpret.plot_slopes(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    well_model_interact,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    well_idata_interact,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    wrt<span class="op">=</span>{<span class="st">"educ4"</span>: [<span class="dv">1</span>, <span class="dv">4</span>]},</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    conditional<span class="op">=</span><span class="st">"dist100"</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    average_by<span class="op">=</span><span class="st">"dist100"</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">7</span>, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-gsoc-update-slopes_files/figure-html/cell-27-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext watermark</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>watermark <span class="op">-</span>n <span class="op">-</span>u <span class="op">-</span>v <span class="op">-</span>iv <span class="op">-</span>w</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Last updated: Wed Aug 16 2023

Python implementation: CPython
Python version       : 3.11.0
IPython version      : 8.13.2

pandas: 2.0.1
arviz : 0.15.1
bambi : 0.10.0.dev0

Watermark: 2.3.1
</code></pre>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>